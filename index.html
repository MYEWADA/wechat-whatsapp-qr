<script>
// 修改后的配置部分
const CONFIG = {
    wechatId: 'your_wechat_id',
    whatsappNumber: '8612345678901', // 去掉+号，使用纯数字
    qrCodeUrls: {
        wechat: 'path/to/wechat-qr.jpg',
        whatsapp: 'path/to/whatsapp-qr.jpg'
    },
    redirectTimeout: 2000,
    whatsappSchemes: [
        'whatsapp://send?phone=',
        'https://wa.me/',
        'https://api.whatsapp.com/send?phone='
    ]
};

// 修改后的检测方法
detectApp() {
    const ua = navigator.userAgent.toLowerCase();
    if (ua.includes('micromessenger')) return 'wechat';
    // 扩展检测规则，包含WhatsApp Business
    if (ua.includes('whatsapp') || ua.includes('whatsapp business')) {
        return 'whatsapp';
    }
    return null;
}

// 修改后的跳转方法
attemptRedirect(app) {
    if (app === 'wechat') {
        window.location.href = `weixin://dl/add?${CONFIG.wechatId}`;
    } else {
        // 尝试多种WhatsApp跳转方案
        this.redirectToWhatsApp();
    }
    
    this.redirectTimer = setTimeout(() => {
        if (!document.hidden) {
            this.showContactOptions();
        }
    }, CONFIG.redirectTimeout);
}

// 新增WhatsApp跳转方法
redirectToWhatsApp() {
    const phone = CONFIG.whatsappNumber.replace(/[^\d]/g, ''); // 确保纯数字
    const messages = [
        `尝试打开 whatsapp://send?phone=${phone}`,
        `尝试打开 https://wa.me/${phone}`,
        `尝试打开 https://api.whatsapp.com/send?phone=${phone}`
    ];
    
    // 先尝试应用内跳转
    window.location.href = `whatsapp://send?phone=${phone}`;
    
    // 备用方案
    setTimeout(() => {
        if (!document.hidden) {
            console.log(messages[0] + ' 失败，尝试备用方案');
            window.location.href = `https://wa.me/${phone}`;
        }
    }, 800);
    
    // 最终备用方案
    setTimeout(() => {
        if (!document.hidden) {
            console.log(messages[1] + ' 失败，尝试最终方案');
            window.location.href = `https://api.whatsapp.com/send?phone=${phone}`;
        }
    }, 1800);
}
</script>
