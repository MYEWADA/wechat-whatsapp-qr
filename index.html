<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- 必须放在head的最前面 -->
    <meta charset="UTF-8">
    <!-- 其他meta标签 -->
    <style>
        /* 样式保持不变 */
    </style>
</head>
<body>
    <!-- 页面结构保持不变 -->

    <script>
        // 确保CONFIG中的URL使用正确编码
        const CONFIG = {
            wechatId: 'your_wechat_id',
            whatsappNumber: '+8612345678901',
            qrCodeUrls: {
                // 使用完整URL或正确相对路径
                wechat: 'https://example.com/path/to/wechat-qr.jpg',
                whatsapp: 'https://example.com/path/to/whatsapp-qr.jpg'
            },
            redirectTimeout: 2000
        };

        // I18N对象确保使用标准引号
        const I18N = {
            zh: {
                title: "我的联系方式",
                // 其他中文文本...
            },
            en: {
                title: "Contact Me",
                // 其他英文文本...
            }
        };

        class QRRedirector {
            // ...其他方法保持不变...

            showDesktopWeChatTip() {
                // 确保模板字符串中的中文编码正确
                this.container.innerHTML = `
                    <div class="option-card">
                        <h3>${this.escapeHtml(I18N[this.currentLang].wechat.title)}</h3>
                        <div class="desktop-tip">
                            ${this.escapeHtml(I18N[this.currentLang].wechat.desktopTip)}
                        </div>
                        <img src="${this.escapeHtml(CONFIG.qrCodeUrls.wechat)}" 
                             class="qr-code" 
                             alt="WeChat QR Code">
                    </div>
                `;
            }

            // 新增HTML转义方法防止XSS
            escapeHtml(unsafe) {
                return unsafe.toString()
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            try {
                new QRRedirector();
            } catch (e) {
                console.error("初始化失败:", e);
                // 显示错误回退界面
                document.querySelector('.container').innerHTML = `
                    <h2>页面加载出错</h2>
                    <p>请扫描二维码或手动添加联系方式</p>
                    <p>WeChat: ${CONFIG.wechatId}</p>
                    <p>WhatsApp: ${CONFIG.whatsappNumber}</p>
                `;
            }
        });
    </script>
</body>
</html>
